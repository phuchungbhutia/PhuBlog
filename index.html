<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>PhuBlog - Home</title>
<link rel="stylesheet" href="style.css" />
<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
</head>
<body>

<nav>
  <a href="index.html" class="logo">PhuBlog</a>
  <ul>
    <li><a href="index.html" aria-current="page">Home</a></li>
    <li><a href="#categories">Categories</a></li>
    <li><a href="about.html">About</a></li>
    <li><a href="contact.html">Contact</a></li>
  </ul>
</nav>

<header>
  <h1>Welcome to PhuBlog</h1>
  <input type="search" id="searchInput" placeholder="Search blogs..." aria-label="Search blogs" />
</header>

<main>
  <section id="recent-posts">
    <h2>Recent Posts</h2>
    <ul id="recentList"></ul>
  </section>

  <section id="top-posts">
    <h2>Top Posts</h2>
    <ul id="topList"></ul>
  </section>

  <section id="categories">
    <h2>Categories</h2>
    <div id="categoriesContainer"></div>
  </section>

  <section id="blogContent" class="hidden">
    <button id="backBtn">‚Üê Back to Home</button>
    <article id="blogArticle"></article>
  </section>
</main>

<script>
let blogs = [];
let filteredBlogs = [];
const recentCount = 5; // number of recent posts to show
const topCount = 5; // number of top posts (for demo just picks first N)

async function fetchBlogs() {
  const res = await fetch('blogs.json');
  blogs = await res.json();
  filteredBlogs = blogs.slice();
  renderAll();
}

function renderAll() {
  renderRecent();
  renderTop();
  renderCategories();
  hideBlog();
}

function renderRecent() {
  const recentList = document.getElementById('recentList');
  recentList.innerHTML = '';
  const recent = blogs.slice(-recentCount).reverse();
  recent.forEach(blog => {
    const li = document.createElement('li');
    li.innerHTML = `<a href="#" data-file="${blog.file}">${blog.title}</a>`;
    recentList.appendChild(li);
  });
}

function renderTop() {
  // For demo: top posts = first N blogs alphabetically
  const topList = document.getElementById('topList');
  topList.innerHTML = '';
  const top = blogs.slice(0, topCount);
  top.forEach(blog => {
    const li = document.createElement('li');
    li.innerHTML = `<a href="#" data-file="${blog.file}">${blog.title}</a>`;
    topList.appendChild(li);
  });
}

function renderCategories() {
  const container = document.getElementById('categoriesContainer');
  container.innerHTML = '';

  // group blogs by category
  const catMap = {};
  filteredBlogs.forEach(blog => {
    if (!catMap[blog.category]) catMap[blog.category] = [];
    catMap[blog.category].push(blog);
  });

  Object.entries(catMap).forEach(([category, blogs]) => {
    const catSection = document.createElement('div');
    catSection.className = 'category-section';

    const header = document.createElement('h3');
    header.textContent = category;
    header.className = 'category-header';
    catSection.appendChild(header);

    const list = document.createElement('ul');
    list.className = 'blog-list hidden';

    blogs.forEach(blog => {
      const li = document.createElement('li');
      li.innerHTML = `<a href="#" data-file="${blog.file}">${blog.title}</a>`;
      list.appendChild(li);
    });

    catSection.appendChild(list);
    container.appendChild(catSection);

    header.addEventListener('click', () => {
      list.classList.toggle('hidden');
    });
  });
}

function showBlog(file) {
  fetch(file)
    .then(res => res.text())
    .then(md => {
      const html = marked.parse(md);
      document.getElementById('blogArticle').innerHTML = html;
      document.getElementById('blogContent').classList.remove('hidden');
      document.querySelector('main > section:not(#blogContent)').forEach(el => el.classList.add('hidden'));
      document.getElementById('backBtn').focus();
      window.scrollTo(0,0);
    })
    .catch(() => alert('Failed to load blog.'));
}

function hideBlog() {
  document.getElementById('blogContent').classList.add('hidden');
  document.querySelectorAll('main > section:not(#blogContent)').forEach(el => el.classList.remove('hidden'));
  window.scrollTo(0,0);
}

document.addEventListener('DOMContentLoaded', () => {
  fetchBlogs();

  // Delegate blog link clicks
  document.body.addEventListener('click', e => {
    if (e.target.tagName === 'A' && e.target.dataset.file) {
      e.preventDefault();
      showBlog(e.target.dataset.file);
    }
  });

  // Back button to hide blog content
  document.getElementById('backBtn').addEventListener('click', hideBlog);

  // Search filter
  const searchInput = document.getElementById('searchInput');
  searchInput.addEventListener('input', () => {
    const term = searchInput.value.toLowerCase();
    filteredBlogs = blogs.filter(blog =>
      blog.title.toLowerCase().includes(term) ||
      blog.description.toLowerCase().includes(term) ||
      blog.category.toLowerCase().includes(term)
    );
    renderCategories();
  });
});
</script>

</body>
</html>
