<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>PhuBlog ‚Äì Home</title>
  <link rel="stylesheet" href="style.css" />
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <style>
    body {
      font-family: sans-serif;
      margin: 0;
      padding: 0;
      line-height: 1.6;
    }
    header {
      background: #333;
      color: white;
      padding: 1rem;
    }
    nav {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    nav h1 a {
      color: white;
      text-decoration: none;
    }
    nav ul {
      list-style: none;
      display: flex;
      gap: 1rem;
      margin: 0;
      padding: 0;
    }
    nav ul li a {
      color: white;
      text-decoration: none;
      font-weight: bold;
    }
    #search {
      width: 100%;
      padding: 0.5rem;
      margin-top: 1rem;
      font-size: 1rem;
    }
    main {
      padding: 1rem;
    }
    ul.blog-list {
      list-style: none;
      padding: 0;
    }
    ul.blog-list li {
      margin-bottom: 1rem;
    }
    ul.blog-list li a {
      font-weight: bold;
      text-decoration: none;
      color: #0077cc;
    }
    ul.blog-list li p {
      margin: 0.3rem 0 0;
    }
    details summary {
      cursor: pointer;
      font-weight: bold;
      margin-top: 1rem;
    }
    .blog-content {
      padding: 1rem;
      background: #f9f9f9;
    }
    .back-link {
      display: inline-block;
      margin-bottom: 1rem;
    }
    footer {
      text-align: center;
      padding: 1rem;
      background: #eee;
      margin-top: 2rem;
    }
  </style>
</head>
<body>

  <header>
    <nav>
      <h1><a href="#" id="nav-home">PhuBlog</a></h1>
      <ul>
        <li><a href="#" id="nav-home-link">Home</a></li>
        <li><a href="#" id="nav-categories-link">Categories</a></li>
        <li><a href="about.html">About</a></li>
        <li><a href="contact.html">Contact</a></li>
      </ul>
    </nav>
    <input type="text" id="search" placeholder="Search blogs..." />
  </header>

  <main id="main-content">
    <!-- JS will inject content here -->
  </main>

  <footer>
    <p>&copy; 2025 PhuBlog. All rights reserved.</p>
  </footer>

  <script type="module">
    const mainContent = document.getElementById("main-content");
    const searchInput = document.getElementById("search");

    let blogs = [];

    async function loadJSON() {
      const res = await fetch("blogs.json");
      blogs = await res.json();
      renderHome();
    }

    function renderHome() {
      mainContent.innerHTML = `
        <section>
          <h2>üìå Recent Posts</h2>
          ${renderBlogList(blogs.slice(-5).reverse())}
        </section>
        <section>
          <h2>‚≠ê Top Posts</h2>
          ${renderBlogList(blogs.slice(0, 3))}
        </section>
        <section>
          <h2>üìÇ Categories</h2>
          ${renderCategories()}
        </section>
      `;
    }

    function renderBlogList(list) {
      return `
        <ul class="blog-list">
          ${list.map(blog => `
            <li>
              <a href="#" onclick="return loadBlog('${blog.file}')">${blog.title}</a>
              <p>${blog.description}</p>
            </li>
          `).join("")}
        </ul>
      `;
    }

    function renderCategories() {
      const grouped = {};
      blogs.forEach(blog => {
        grouped[blog.category] = grouped[blog.category] || [];
        grouped[blog.category].push(blog);
      });

      return Object.entries(grouped).map(([cat, items]) => `
        <details>
          <summary>${cat}</summary>
          ${renderBlogList(items)}
        </details>
      `).join("");
    }

    window.loadBlog = async function (file) {
      try {
        const res = await fetch(file);
        const md = await res.text();
        mainContent.innerHTML = `
          <div class="blog-content">
            <a href="#" class="back-link" onclick="renderHome()">‚Üê Back to Home</a>
            <article>${marked.parse(md)}</article>
          </div>
        `;
      } catch (e) {
        mainContent.innerHTML = `<p>‚ö†Ô∏è Failed to load blog.</p>`;
      }
    }

    searchInput.addEventListener("input", (e) => {
      const q = e.target.value.toLowerCase();
      const filtered = blogs.filter(blog =>
        blog.title.toLowerCase().includes(q) || blog.description.toLowerCase().includes(q)
      );
      mainContent.innerHTML = `
        <section>
          <h2>üîç Search Results for "${q}"</h2>
          ${renderBlogList(filtered)}
        </section>
      `;
    });

    // Navigation
    document.getElementById("nav-home-link").onclick = renderHome;
    document.getElementById("nav-home").onclick = renderHome;
    document.getElementById("nav-categories-link").onclick = () => {
      mainContent.innerHTML = `
        <section>
          <h2>üìö All Categories</h2>
          ${renderCategories()}
        </section>
      `;
    };

    loadJSON();
  </script>

</body>
</html>
